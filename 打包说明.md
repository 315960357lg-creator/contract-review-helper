# åˆåŒå®¡æŸ¥å°åŠ©æ‰‹ - Windowsä¸€é”®æ‰“åŒ…å®Œæ•´æŒ‡å—

## ğŸ“¦ æ‰“åŒ…å·¥å…·å·²åˆ›å»º

å·²ä¸ºæ‚¨åˆ›å»ºä»¥ä¸‹æ‰“åŒ…å·¥å…·ï¼š

### 1. æ ¸å¿ƒæ–‡ä»¶
- `build.spec` - PyInstalleræ‰“åŒ…é…ç½®
- `build_windows.bat` - è‡ªåŠ¨æ‰“åŒ…è„šæœ¬
- `installer/build_installer.bat` - å®‰è£…ç¨‹åºåˆ¶ä½œè„šæœ¬

### 2. æ–‡æ¡£
- `installer/WINDOWS_INSTALL.md` - è¯¦ç»†æ‰“åŒ…è¯´æ˜

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆä¸‰ç§æ–¹å¼ï¼‰

### æ–¹å¼ä¸€ï¼šåœ¨Windowsç³»ç»Ÿä¸Šæ‰“åŒ…ï¼ˆæœ€ç®€å•ï¼‰

1. **å‡†å¤‡Windowsç¯å¢ƒ**
   - å®‰è£… Python 3.8+
   - ä¸‹è½½é¡¹ç›®åˆ°Windowsç”µè„‘

2. **è¿è¡Œæ‰“åŒ…è„šæœ¬**
   ```batch
   åŒå‡»: build_windows.bat
   ```

3. **å®Œæˆ**
   - å¯æ‰§è¡Œæ–‡ä»¶åœ¨ `dist` æ–‡ä»¶å¤¹
   - ç›´æ¥åˆ†å‘å³å¯ä½¿ç”¨

### æ–¹å¼äºŒï¼šåœ¨macOS/Linuxä¸Šäº¤å‰ç¼–è¯‘

1. **å®‰è£…Wineå’ŒPython**
   ```bash
   # macOS
   brew install wine-stable

   # å®‰è£…Windowsç‰ˆPythonåˆ°Wine
   wine python-3.11.x-amd64.exe
   ```

2. **åœ¨Wineç¯å¢ƒä¸­æ‰“åŒ…**
   ```bash
   wine pyinstaller build.spec
   ```

### æ–¹å¼ä¸‰ï¼šä½¿ç”¨GitHub Actionsè‡ªåŠ¨æ‰“åŒ…

åˆ›å»º `.github/workflows/build.yml`:

```yaml
name: Build Windows Executable

on:
  push:
    tags:
      - 'v*'

jobs:
  build:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.11'

    - name: Install dependencies
      run: |
        pip install pyinstaller==6.3.0
        pip install -r requirements.txt

    - name: Build executable
      run: |
        pyinstaller build.spec --clean

    - name: Upload artifact
      uses: actions/upload-artifact@v2
      with:
        name: contract-reviewer-windows
        path: dist/*.exe
```

æ¨é€ç‰ˆæœ¬æ ‡ç­¾å³å¯è‡ªåŠ¨æ„å»ºï¼š
```bash
git tag v1.0.0
git push origin v1.0.0
```

## ğŸ“‹ æ‰“åŒ…è¾“å‡ºè¯´æ˜

### å•æ–‡ä»¶å¯æ‰§è¡Œç¨‹åº
```
dist/
â””â”€â”€ åˆåŒå®¡æŸ¥å°åŠ©æ‰‹.exe    # çº¦150-200MB
```

**ç‰¹ç‚¹ï¼š**
- æ— éœ€å®‰è£…Python
- åŒå‡»å³å¯è¿è¡Œ
- åŒ…å«æ‰€æœ‰ä¾èµ–
- é€‚åˆéæŠ€æœ¯ç”¨æˆ·

### å®‰è£…ç¨‹åºï¼ˆå¯é€‰ï¼‰

è¿è¡Œ `installer/build_installer.bat` åç”Ÿæˆï¼š

```
release/
â”œâ”€â”€ åˆåŒå®¡æŸ¥å°åŠ©æ‰‹_å®‰è£…ç¨‹åº.exe  # å¸¦å‘å¯¼çš„å®‰è£…ç¨‹åº
â””â”€â”€ ä¾¿æºç‰ˆ/
    â”œâ”€â”€ åˆåŒå®¡æŸ¥å°åŠ©æ‰‹.exe
    â”œâ”€â”€ å¯åŠ¨åŠ©æ‰‹.bat
    â””â”€â”€ ä½¿ç”¨è¯´æ˜.txt
```

## ğŸ¯ åˆ†å‘å»ºè®®

### 1. ç›´æ¥åˆ†å‘exeæ–‡ä»¶
```
âœ… æœ€ç®€å•
âœ… æ— éœ€å®‰è£…
âŒ æ–‡ä»¶è¾ƒå¤§
âŒ å¯èƒ½è¢«æ€æ¯’è½¯ä»¶è¯¯æŠ¥
```

### 2. å‹ç¼©åŒ…åˆ†å‘
```bash
# åˆ›å»ºè‡ªè§£å‹å‹ç¼©åŒ…ï¼ˆæ¨èï¼‰
7z a -sfx7z.sfx åˆåŒå®¡æŸ¥å°åŠ©æ‰‹_Setup.exe dist\*
```

### 3. å®‰è£…ç¨‹åºåˆ†å‘ï¼ˆæ¨èä¼ä¸šä½¿ç”¨ï¼‰
```
âœ… ä¸“ä¸šåŒ–
âœ… å¯è‡ªå®šä¹‰å®‰è£…è·¯å¾„
âœ… è‡ªåŠ¨åˆ›å»ºå¿«æ·æ–¹å¼
âœ… æ”¯æŒå¸è½½
```

## ğŸ”§ æ‰“åŒ…é—®é¢˜æ’æŸ¥

### é—®é¢˜1: æç¤ºç¼ºå°‘æ¨¡å—
```bash
# è§£å†³æ–¹æ³•ï¼šæ˜¾å¼æ·»åŠ éšè—å¯¼å…¥
# ç¼–è¾‘ build.specï¼Œåœ¨ hiddenimports ä¸­æ·»åŠ 
hiddenimports=[
    'ç¼ºå°‘çš„æ¨¡å—å',
    ...
]
```

### é—®é¢˜2: è¿è¡Œæ—¶æ‰¾ä¸åˆ°æ–‡ä»¶
```python
# ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„è·¯å¾„å¤„ç†
import os
from pathlib import Path

# èµ„æºæ–‡ä»¶è·¯å¾„
resource_path = Path(__file__).parent / 'assets' / 'file.txt'

# é…ç½®æ–‡ä»¶è·¯å¾„
config_dir = Path.home() / '.åˆåŒå®¡æŸ¥åŠ©æ‰‹'
```

### é—®é¢˜3: æ–‡ä»¶å¤ªå¤§
```python
# åœ¨ build.spec ä¸­æ’é™¤ä¸éœ€è¦çš„æ¨¡å—
excludes=[
    'tkinter',
    'matplotlib',
    'numpy',  # å¦‚æœä¸éœ€è¦
]
```

## ğŸ“ ç”¨æˆ·å®‰è£…è¯´æ˜

åˆ›å»ºä¸€ä¸ªç®€å•çš„å®‰è£…è¯´æ˜æ–‡ä»¶ä¾›æœ€ç»ˆç”¨æˆ·ä½¿ç”¨ï¼š

```markdown
# å®‰è£…è¯´æ˜

1. ä¸‹è½½ `åˆåŒå®¡æŸ¥å°åŠ©æ‰‹.exe`

2. åŒå‡»è¿è¡Œï¼ˆé¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨åˆ›å»ºé…ç½®æ–‡ä»¶ï¼‰

3. é€‰æ‹©AIæ¨¡å‹ï¼š
   - æœ¬åœ°æ¨¡å‹ï¼šéœ€è¦å®‰è£…Ollamaï¼ˆæ¨èï¼‰
   - äº‘ç«¯æ¨¡å‹ï¼šéœ€è¦DeepSeek APIå¯†é’¥

4. å¼€å§‹ä½¿ç”¨ï¼

è¯¦ç»†æ–‡æ¡£ï¼šæŸ¥çœ‹ç¨‹åºå†…çš„å¸®åŠ©èœå•
```

## âœ… æ‰“åŒ…æµ‹è¯•æ¸…å•

æ‰“åŒ…å®Œæˆåï¼Œè¯·æµ‹è¯•ï¼š

- [ ] åŒå‡»exeæ–‡ä»¶èƒ½æ­£å¸¸å¯åŠ¨
- [ ] é€‰æ‹©ç‰ˆæœ¬åŠŸèƒ½æ­£å¸¸
- [ ] æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ­£å¸¸
- [ ] AIå®¡æŸ¥åŠŸèƒ½æ­£å¸¸
- [ ] å†å²è®°å½•åŠŸèƒ½æ­£å¸¸
- [ ] é…ç½®ä¿å­˜å’ŒåŠ è½½æ­£å¸¸
- [ ] åœ¨ä¸åŒWindowsç‰ˆæœ¬æµ‹è¯•ï¼ˆWin7/10/11ï¼‰
- [ ] 32ä½å’Œ64ä½ç³»ç»Ÿéƒ½æµ‹è¯•

## ğŸ¨ é«˜çº§é…ç½®

### æ·»åŠ ç¨‹åºå›¾æ ‡

1. å‡†å¤‡ `.ico` æ–‡ä»¶ï¼ˆ256x256åƒç´ ï¼‰
2. æ”¾åœ¨ `assets/app_icon.ico`
3. åœ¨ `build.spec` ä¸­è®¾ç½®ï¼š
   ```python
   icon='assets/app_icon.ico'
   ```

### ä»£ç ç­¾åï¼ˆé¿å…æ€æ¯’è½¯ä»¶è¯¯æŠ¥ï¼‰

```bash
# ä½¿ç”¨signtoolç­¾åï¼ˆéœ€è¦è¯ä¹¦ï¼‰
signtool sign /f certificate.p12 /p password åˆåŒå®¡æŸ¥å°åŠ©æ‰‹.exe
```

### è®¾ç½®ç‰ˆæœ¬ä¿¡æ¯

åœ¨ `build.spec` ä¸­æ·»åŠ ï¼š
```python
exe = EXE(
    ...
    version='version.txt',  # ç‰ˆæœ¬ä¿¡æ¯æ–‡ä»¶
)
```

åˆ›å»º `version.txt`:
```
VSVersionInfo(
  ffi=FixedFileInfo(
    filevers=(1, 0, 0, 0),
    prodvers=(1, 0, 0, 0),
    mask=0x3f,
    flags=0x0,
    OS=0x40004,
    fileType=0x1,
    subtype=0x0,
    date=(0, 0)
  ),
  kids=[
    StringFileInfo(
      [
        StringTable(
          u'040904B0',
          [
            StringStruct(u'CompanyName', u'æ‚¨çš„å…¬å¸å'),
            StringStruct(u'FileDescription', u'åˆåŒå®¡æŸ¥AIåŠ©æ‰‹'),
            StringStruct(u'FileVersion', u'1.0.0.0'),
            StringStruct(u'ProductName', u'åˆåŒå®¡æŸ¥å°åŠ©æ‰‹'),
            StringStruct(u'ProductVersion', u'1.0.0.0')
          ])
      ]
    )
  ]
)
```

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æŸ¥çœ‹ `installer/WINDOWS_INSTALL.md` è¯¦ç»†æ–‡æ¡£
2. æ£€æŸ¥ PyInstaller å®˜æ–¹æ–‡æ¡£ï¼šhttps://pyinstaller.org/
3. ç¡®ä¿åœ¨å¹²å‡€çš„ç¯å¢ƒä¸­æ‰“åŒ…ï¼ˆä½¿ç”¨è™šæ‹Ÿç¯å¢ƒï¼‰
