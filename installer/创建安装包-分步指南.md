# 合同审查小助手 - 完整安装包制作指南

## 📋 准备工作（在Windows电脑上执行）

### 步骤1：准备Windows环境

在Windows电脑上完成以下操作：

#### 1.1 安装Python
- 下载 Python 3.11（推荐）或 Python 3.8+
- 下载地址：https://www.python.org/downloads/
- ⚠️ **重要**：安装时勾选 "Add Python to PATH"

验证安装：
```batch
python --version
```

#### 1.2 安装Git（可选但推荐）
- 下载：https://git-scm.com/download/win
- 安装后可方便地获取项目

#### 1.3 获取项目代码

**方法A：使用Git（推荐）**
```batch
git clone <项目地址>
cd 审查合同助手
```

**方法B：直接下载**
1. 下载项目ZIP文件
2. 解压到文件夹
3. 进入解压后的目录

### 步骤2：检查项目文件

确认以下文件存在：
```
审查合同助手/
├── launch.py                 ✓ 主启动文件
├── build.spec                ✓ 打包配置
├── build_windows.bat         ✓ 自动打包脚本
├── requirements.txt          ✓ 依赖列表
├── installer/
│   ├── build_installer.bat   ✓ 安装制作脚本
│   └── build_all.bat         ✓ 完整打包脚本
└── assets/
    └── app_icon.png          ✓ 程序图标
```

## 🚀 完整打包流程

### 方式一：一键完整打包（最简单）⭐

**在项目根目录，双击运行：**
```
installer\build_all.bat
```

这个脚本会自动：
1. ✓ 安装所有依赖
2. ✓ 使用PyInstaller打包
3. ✓ 创建安装程序
4. ✓ 创建便携版
5. ✓ 复制说明文档

**等待5-15分钟，完成后查看输出文件。**

---

### 方式二：分步打包（可控性更强）

#### 第1步：安装打包工具

打开命令提示符（CMD），进入项目目录：
```batch
cd "路径到\审查合同助手"
```

安装PyInstaller：
```batch
pip install pyinstaller==6.3.0
```

#### 第2步：安装项目依赖

```batch
pip install -r requirements.txt
```

如果遇到网络问题，使用国内镜像：
```batch
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

#### 第3步：执行打包

```batch
pyinstaller build.spec --clean
```

等待5-10分钟，打包完成后会生成：
```
dist/
└── 合同审查小助手.exe
```

#### 第4步：测试可执行文件

```batch
cd dist
合同审查小助手.exe
```

测试功能：
- [ ] 程序能正常启动
- [ ] 版本选择界面正常
- [ ] 能打开专业版和简洁版
- [ ] 界面显示正常

#### 第5步：创建安装程序

返回项目根目录，进入installer文件夹：
```batch
cd installer
build_installer.bat
```

这会创建两种安装包：

**A. 便携版（自动创建）**
```
release/便携版/
├── 合同审查小助手.exe
├── 启动助手.bat
└── 使用说明.txt
```

**B. 安装程序（需要NSIS）**

如果已安装NSIS（https://nsis.sourceforge.io/），会生成：
```
合同审查小助手_安装程序.exe
```

#### 第6步：创建压缩包（可选）

**使用7-Zip创建自解压包：**
```batch
"C:\Program Files\7-Zip\7z.exe" a -sfx7z.sfx 合同审查小助手_v1.0.exe .\release\便携版\*
```

**或创建普通ZIP：**
```batch
powershell Compress-Archive -Path ".\release\便携版\*" -DestinationPath "合同审查小助手_v1.0.zip"
```

## 📦 输出文件说明

### 完整打包后的文件结构

```
审查合同助手/
│
├── dist/                           # PyInstaller输出
│   └── 合同审查小助手.exe          # 主程序（150-200MB）
│
├── release/                        # 最终发布文件
│   ├── 合同审查小助手_安装程序.exe # 安装向导版
│   └── 便携版/
│       ├── 合同审查小助手.exe
│       ├── 启动助手.bat
│       ├── 使用说明.txt
│       └── 配置文件/
│           └── .env.example
│
└── installer/
    └── build_all.bat               # 完整打包脚本
```

## 🎯 分发给用户

### 推荐方案1：安装程序（最专业）⭐

**文件**: `合同审查小助手_安装程序.exe`

**用户操作**：
1. 双击运行安装程序
2. 选择安装路径
3. 自动创建桌面快捷方式
4. 从开始菜单启动

**优点**：
- ✓ 用户体验最好
- ✓ 自动配置环境
- ✓ 支持卸载
- ✓ 适合企业部署

### 推荐方案2：便携版（最灵活）

**文件**: `release/便携版/` 整个文件夹

**用户操作**：
1. 解压到任意位置
2. 双击 `合同审查小助手.exe`
3. 或双击 `启动助手.bat`

**优点**：
- ✓ 无需安装
- ✓ 可放U盘使用
- ✓ 不写入注册表
- ✓ 可多版本共存

### 推荐方案3：单文件（最简单）

**文件**: `dist/合同审查小助手.exe`

**用户操作**：
1. 下载单个exe文件
2. 双击运行

**优点**：
- ✓ 文件最少
- ✓ 最简单
- ❌ 可能被杀软误报

## ✅ 打包验证清单

打包完成后，请务必测试：

### 基础功能测试
- [ ] 在Windows 10 64位上运行
- [ ] 在Windows 7 64位上运行（如有条件）
- [ ] 程序启动正常
- [ ] 版本选择界面显示正常
- [ ] 专业版界面正常
- [ ] 简洁版界面正常

### 核心功能测试
- [ ] 文件上传功能
- [ ] AI审查功能（需要配置AI模型）
- [ ] 历史记录功能
- [ ] 配置保存功能
- [ ] 报告导出功能

### 安装程序测试（如果制作了）
- [ ] 安装程序能正常运行
- [ ] 安装路径选择正常
- [ ] 桌面快捷方式创建成功
- [ ] 开始菜单项创建成功
- [ ] 卸载功能正常

## 📋 常见问题解决

### Q1: PyInstaller安装失败
```batch
# 使用国内镜像
pip install pyinstaller -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### Q2: 打包后文件太大
```batch
# 使用UPX压缩（已默认启用）
# 或修改 build.spec，排除不需要的模块
excludes=['tkinter', 'matplotlib', ...]
```

### Q3: 运行时提示缺少模块
编辑 `build.spec`，添加到 `hiddenimports`：
```python
hiddenimports=[
    '缺少的模块名',
]
```

### Q4: 杀毒软件报毒
这是正常的误报：
1. 添加到杀软白名单
2. 或申请代码签名证书（需要购买）
3. 使用数字签名可以避免误报

### Q5: NSIS安装失败
```batch
# 跳过NSIS，只使用便携版
# 修改 installer\build_installer.bat
# 注释掉NSIS相关部分
```

## 🚀 一键打包完整命令

如果你想一次性完成所有操作，在项目根目录执行：

```batch
REM 完整打包流程
@echo off
echo 开始打包...

REM 1. 安装依赖
echo [1/4] 安装依赖...
pip install pyinstaller==6.3.0
pip install -r requirements.txt

REM 2. 打包程序
echo [2/4] 打包程序...
pyinstaller build.spec --clean

REM 3. 复制文件
echo [3/4] 准备发布文件...
if not exist "release\便携版" mkdir release\便携版
copy dist\合同审查小助手.exe release\便携版\
copy 用户安装指南.md release\便携版\

REM 4. 创建启动脚本
echo @echo off > release\便携版\启动.bat
echo start 合同审查小助手.exe >> release\便携版\启动.bat

echo [4/4] 完成！
echo.
echo 输出位置: release\便携版\
pause
```

保存为 `快速打包.bat`，双击运行即可。

## 📞 需要帮助？

如果遇到问题：

1. **查看详细文档**：`打包说明.md`
2. **查看技术文档**：`installer/WINDOWS_INSTALL.md`
3. **查看用户指南**：`用户安装指南.md`

## 🎉 打包完成！

打包成功后，您就拥有：
- ✅ Windows独立可执行文件
- ✅ 支持Windows 7/10/11 (32/64位)
- ✅ 用户双击即用
- ✅ 完整的安装说明
- ✅ 可以自由分发

祝您使用愉快！
